/* data.js - í…ŒìŠ¤íŠ¸ìš© ê°€ì§œ ë°ì´í„° ë° ì„œë²„ ëª¨í‚¹ íŒŒì¼ */

// ==========================================
// 1. ì´ˆê¸° ë°ì´í„° ì„¤ì • (ì—¬ê¸°ë¥¼ ìˆ˜ì •í•˜ë©´ ì´ˆê¸°ê°’ì´ ë°”ë€ë‹ˆë‹¤)
// ==========================================

// ë‚ ì§œ ê³„ì‚° (ì˜¤ëŠ˜, 10ì¼ ì „)
const TODAY = new Date().toISOString().split('T')[0];
const TEN_DAYS_AGO = new Date();
TEN_DAYS_AGO.setDate(TEN_DAYS_AGO.getDate() - 10);
const DATE_OLD = TEN_DAYS_AGO.toISOString().split('T')[0];

const MOCK_DB = {
    // 1. í’ˆëª© ë¦¬ìŠ¤íŠ¸
    items: {
        "ì‚¼ì‹œì„¸ë¼": [
            { "í’ˆëª©ëª…": "ëŒ€íŒŒ(ë‹¨)", "ë°œì£¼ë‹¨ìœ„": "ë‹¨", "ì¤‘ìš”ë„": "ìƒ" },      // [Test] ì¤‘ìš”ë„ 'ìƒ', ìž¬ê³  ë§ŽìŒ -> ê²½ê³  ë– ì•¼ í•¨
            { "í’ˆëª©ëª…": "ì²­ì–‘ê³ ì¶”", "ë°œì£¼ë‹¨ìœ„": "ë´‰", "ì¤‘ìš”ë„": "ì¤‘" },      // [Test] ì¤‘ìš”ë„ 'ì¤‘', ìž¬ê³  ë§ŽìŒ, ì˜¤ëž˜ë¨ -> ê²½ê³ +ë‚ ì§œ í™•ì¸
            { "í’ˆëª©ëª…": "ë‚˜ë¬´ì “ê°€ë½", "ë°œì£¼ë‹¨ìœ„": "ë°•ìŠ¤", "ì¤‘ìš”ë„": "í•˜" },  // [Test] ì¤‘ìš”ë„ 'í•˜', ìž¬ê³  ë§ŽìŒ -> ê²½ê³  ì•ˆ ë– ì•¼ í•¨
            { "í’ˆëª©ëª…": "ì–‘íŒŒ", "ë°œì£¼ë‹¨ìœ„": "ë§", "ì¤‘ìš”ë„": "ìƒ" }           // [Test] ì •ìƒ ë°œì£¼ ëŒ€ìƒ
        ],
        "SPC": [
            { "í’ˆëª©ëª…": "ì¹˜ì¦ˆì¼€ì´í¬(1box/ëƒ‰ë™)", "ë°œì£¼ë‹¨ìœ„": "box", "ì¤‘ìš”ë„": "ìƒ" }, // [Test] SPCëŠ” ìž¬ê³  ë§Žì•„ë„ ë¬´ì¡°ê±´ ê²½ê³ 
            { "í’ˆëª©ëª…": "ì‹ë¹µ(10ea/ëƒ‰ìž¥)", "ë°œì£¼ë‹¨ìœ„": "ë´‰", "ì¤‘ìš”ë„": "ì¤‘" }
        ],
        "ê¸°íƒ€": [
            { "í’ˆëª©ëª…": "ì°¸ì´ìŠ¬", "ë°œì£¼ë‹¨ìœ„": "ë°•ìŠ¤", "ì¤‘ìš”ë„": "ìƒ" }
        ]
    },

    // 2. í˜„ìž¬ ìž¬ê³  (í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ì— ë§žì¶° ì„¤ì •ë¨)
    inventory: {
        "ì‚¼ì‹œì„¸ë¼_ëŒ€íŒŒ(ë‹¨)": 100,      // ì¶©ë¶„í•¨ (ë°œì£¼ 0)
        "ì‚¼ì‹œì„¸ë¼_ì²­ì–‘ê³ ì¶”": 100,      // ì¶©ë¶„í•¨ (ë°œì£¼ 0)
        "ì‚¼ì‹œì„¸ë¼_ë‚˜ë¬´ì “ê°€ë½": 100,    // ì¶©ë¶„í•¨ (ë°œì£¼ 0) -> ì¤‘ìš”ë„ 'í•˜'ë¼ ë¬´ì‹œë¨
        "ì‚¼ì‹œì„¸ë¼_ì–‘íŒŒ": 0.5,          // ë¶€ì¡±í•¨ -> ë°œì£¼ë¨
        "SPC_ì¹˜ì¦ˆì¼€ì´í¬(1box/ëƒ‰ë™)": 50, // ì¶©ë¶„í•¨ (ë°œì£¼ 0) -> SPCë¼ ê²½ê³  ëœ¸
        "SPC_ì‹ë¹µ(10ea/ëƒ‰ìž¥)": 0,       // ë¶€ì¡±í•¨ -> ë°œì£¼ë¨
        "ê¸°íƒ€_ì°¸ì´ìŠ¬": 0
    },

    // 3. í•˜ë£¨ ì‚¬ìš©ëŸ‰
    dailyUsage: {
        "ì‚¼ì‹œì„¸ë¼_ëŒ€íŒŒ(ë‹¨)": 1.0,
        "ì‚¼ì‹œì„¸ë¼_ì²­ì–‘ê³ ì¶”": 1.0,
        "ì‚¼ì‹œì„¸ë¼_ë‚˜ë¬´ì “ê°€ë½": 0.1,
        "ì‚¼ì‹œì„¸ë¼_ì–‘íŒŒ": 2.0,
        "SPC_ì¹˜ì¦ˆì¼€ì´í¬(1box/ëƒ‰ë™)": 0.5,
        "SPC_ì‹ë¹µ(10ea/ëƒ‰ìž¥)": 2.0,
        "ê¸°íƒ€_ì°¸ì´ìŠ¬": 1.0
    },

    // 4. ë§ˆì§€ë§‰ ë°œì£¼ ì¼ìž (ì˜¤ëž˜ëœ ë‚ ì§œ í…ŒìŠ¤íŠ¸)
    lastOrders: {
        "ì‚¼ì‹œì„¸ë¼_ëŒ€íŒŒ(ë‹¨)": TODAY,
        "ì‚¼ì‹œì„¸ë¼_ì²­ì–‘ê³ ì¶”": DATE_OLD,    // [Test] ëª¨ë‹¬ì°½ì— 10ì¼ ì „ ë‚ ì§œ ëœ¨ëŠ”ì§€ í™•ì¸
        "SPC_ì¹˜ì¦ˆì¼€ì´í¬(1box/ëƒ‰ë™)": DATE_OLD 
    },

    // 5. íœ´ì¼ ì„¤ì •
    holidays: {
        'store': ['2025-05-05'],
        'ì‚¼ì‹œì„¸ë¼': [], 'SPC': [], 'ê¸°íƒ€': []
    }
};


// ==========================================
// 2. ì„œë²„ í†µì‹  ê°€ë¡œì±„ê¸° (Mocking)
// ==========================================
console.log("ðŸ“¢ [data.js] í…ŒìŠ¤íŠ¸ ë°ì´í„° íŒŒì¼ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.");

// ê¸°ì¡´ fetch ë°±ì—…
window.originalFetch = window.fetch;

// fetch í•¨ìˆ˜ ìž¬ì •ì˜ (ê°€ì§œ ì‘ë‹µ ë³´ë‚´ê¸°)
window.fetch = async (url, options) => {
    console.log(`ðŸ“¡ [ê°€ìƒ ì„œë²„ ìš”ì²­] ${url}`);

    // ë„¤íŠ¸ì›Œí¬ ì§€ì—° íš¨ê³¼ (0.2ì´ˆ)
    await new Promise(r => setTimeout(r, 200));

    // 1) í’ˆëª© ì¡°íšŒ
    if (url.includes('/items')) {
        return { json: async () => ({ success: true, items: MOCK_DB.items }) };
    }
    
    // 2) í˜„ìž¬ ìž¬ê³  ì¡°íšŒ
    if (url.includes('/current') && (!options || options.method === 'GET')) {
        return { json: async () => ({ success: true, inventory: MOCK_DB.inventory }) };
    }

    // 3) ìž¬ê³  ì €ìž¥ (POST)
    if (url.includes('/current') && options && options.method === 'POST') {
        const body = JSON.parse(options.body);
        // ë©”ëª¨ë¦¬ ìƒì˜ ë°ì´í„° ì—…ë°ì´íŠ¸ (ìƒˆë¡œê³ ì¹¨ ì „ê¹Œì§€ ìœ ì§€)
        MOCK_DB.inventory = body.inventory;
        console.log("ðŸ’¾ [ê°€ìƒ ì„œë²„] ìž¬ê³  ì—…ë°ì´íŠ¸ ë¨:", MOCK_DB.inventory);
        return { json: async () => ({ success: true }) };
    }

    // 4) í•˜ë£¨ ì‚¬ìš©ëŸ‰ ì¡°íšŒ
    if (url.includes('/daily-usage') && (!options || options.method === 'GET')) {
        return { json: async () => ({ success: true, usage: MOCK_DB.dailyUsage }) };
    }

    // 5) ë§ˆì§€ë§‰ ë°œì£¼ ë‚´ì—­ ì¡°íšŒ
    if (url.includes('/last-orders')) {
        return { json: async () => ({ success: true, lastOrders: MOCK_DB.lastOrders }) };
    }

    // 6) íœ´ì¼ ì¡°íšŒ
    if (url.includes('/holidays')) {
        return { json: async () => ({ success: true, holidays: MOCK_DB.holidays }) };
    }

    // 7) ë°œì£¼ ìš”ì²­ (POST)
    if (url.includes('/orders') && options && options.method === 'POST') {
        const body = JSON.parse(options.body);
        console.log("ðŸ“¦ [ê°€ìƒ ì„œë²„] ë°œì£¼ì„œ ì ‘ìˆ˜ ì™„ë£Œ:", body);
        return { json: async () => ({ success: true }) };
    }

    // ê·¸ ì™¸
    return { json: async () => ({ success: false, message: "ì•Œ ìˆ˜ ì—†ëŠ” ìš”ì²­" }) };
};